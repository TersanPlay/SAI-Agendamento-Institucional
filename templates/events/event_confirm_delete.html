{% extends 'base.html' %}

{% block title %}Excluir Evento - EventoSys{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-8">
        <!-- Breadcrumb -->
        <nav class="flex mb-4" aria-label="Breadcrumb">
            <ol class="inline-flex items-center space-x-1 md:space-x-3">
                <li class="inline-flex items-center">
                    <a href="{% url 'events:dashboard' %}" class="text-gray-700 hover:text-blue-600 text-sm font-medium">
                        Dashboard
                    </a>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 text-xs mx-2"></i>
                        <a href="{% url 'events:event_list' %}" class="text-gray-700 hover:text-blue-600 text-sm font-medium">
                            Eventos
                        </a>
                    </div>
                </li>
                <li>
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 text-xs mx-2"></i>
                        <a href="{% url 'events:event_detail' event.pk %}" class="text-gray-700 hover:text-blue-600 text-sm font-medium">
                            {{ event.name|truncatechars:25 }}
                        </a>
                    </div>
                </li>
                <li aria-current="page">
                    <div class="flex items-center">
                        <i class="fas fa-chevron-right text-gray-400 text-xs mx-2"></i>
                        <span class="text-gray-500 text-sm">Excluir</span>
                    </div>
                </li>
            </ol>
        </nav>

        <h1 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl">
            üóëÔ∏è Excluir Evento
        </h1>
        <p class="mt-1 text-sm text-gray-500">
            Esta a√ß√£o n√£o pode ser desfeita. Todos os dados relacionados ao evento ser√£o perdidos permanentemente.
        </p>
    </div>

    <!-- Confirmation Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <!-- Warning Header -->
        <div class="bg-red-50 px-6 py-4 border-b border-red-200">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-lg font-medium text-red-900">
                        Confirmar Exclus√£o
                    </h3>
                    <p class="text-sm text-red-800">
                        Voc√™ est√° prestes a excluir permanentemente este evento.
                    </p>
                </div>
            </div>
        </div>

        <!-- Event Information -->
        <div class="px-6 py-6">
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <h4 class="font-medium text-gray-900 mb-3">Evento a ser exclu√≠do:</h4>
                
                <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Event Name -->
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Nome</dt>
                        <dd class="mt-1 text-sm text-gray-900 font-medium">{{ event.name }}</dd>
                    </div>

                    <!-- Event Type -->
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Tipo</dt>
                        <dd class="mt-1">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                {{ event.event_type.get_name_display }}
                            </span>
                        </dd>
                    </div>

                    <!-- Date and Time -->
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Data e Hor√°rio</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-calendar text-gray-400 mr-2"></i>
                                {{ event.start_datetime|date:"d/m/Y H:i" }}
                                {% if event.end_datetime %}
                                    - {{ event.end_datetime|date:"H:i" }}
                                {% endif %}
                            </div>
                        </dd>
                    </div>

                    <!-- Status -->
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Status</dt>
                        <dd class="mt-1">
                            {% if event.status == 'planejado' %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                {{ event.get_status_display }}
                            </span>
                            {% elif event.status == 'em_andamento' %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                {{ event.get_status_display }}
                            </span>
                            {% elif event.status == 'concluido' %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                                {{ event.get_status_display }}
                            </span>
                            {% elif event.status == 'cancelado' %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                {{ event.get_status_display }}
                            </span>
                            {% endif %}
                        </dd>
                    </div>

                    <!-- Responsible Person -->
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Respons√°vel</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-user text-gray-400 mr-2"></i>
                                {{ event.responsible_person.get_full_name|default:event.responsible_person.username }}
                            </div>
                        </dd>
                    </div>

                    <!-- Department -->
                    {% if event.department %}
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Departamento</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-building text-gray-400 mr-2"></i>
                                {{ event.department.name }}
                            </div>
                        </dd>
                    </div>
                    {% endif %}

                    <!-- Location -->
                    {% if event.location %}
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Local</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-map-marker-alt text-gray-400 mr-2"></i>
                                {{ event.location }}
                            </div>
                        </dd>
                    </div>
                    {% endif %}

                    <!-- Expected Participants -->
                    {% if event.expected_participants %}
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Participantes Esperados</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <div class="flex items-center">
                                <i class="fas fa-user-friends text-gray-400 mr-2"></i>
                                {{ event.expected_participants }}
                            </div>
                        </dd>
                    </div>
                    {% endif %}
                </dl>
            </div>

            <!-- Related Data Warning -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                <div class="flex">
                    <div class="flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                    </div>
                    <div class="ml-3">
                        <h4 class="text-sm font-medium text-yellow-800">
                            Dados que ser√£o exclu√≠dos junto com o evento:
                        </h4>
                        <div class="mt-2 text-sm text-yellow-700">
                            <ul class="list-disc list-inside space-y-1">
                                <li>Todos os documentos anexados ({{ event.documents.count|default:0 }} documento{{ event.documents.count|pluralize }})</li>
                                <li>Lista de participantes ({{ event.participants.count|default:0 }} participante{{ event.participants.count|pluralize }})</li>
                                <li>Hist√≥rico de altera√ß√µes ({{ event.history.count|default:0 }} registro{{ event.history.count|pluralize }})</li>
                                <li>Notifica√ß√µes relacionadas ao evento</li>
                                <li>Registros de auditoria do evento</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation Text -->
            <div class="mb-6">
                <label for="confirmation" class="block text-sm font-medium text-gray-700 mb-2">
                    Para confirmar a exclus√£o, digite exatamente: <span class="font-mono font-bold text-red-600">{{ event.name }}</span>
                </label>
                <input type="text" 
                       id="confirmation" 
                       name="confirmation"
                       class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm"
                       placeholder="Digite o nome do evento aqui..."
                       autocomplete="off">
                <p class="mt-1 text-xs text-gray-500">
                    Esta verifica√ß√£o ajuda a prevenir exclus√µes acidentais.
                </p>
            </div>

            <!-- Form -->
            <form method="post" id="delete-form">
                {% csrf_token %}
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3">
                    <a href="{% url 'events:event_detail' event.pk %}" 
                       class="inline-flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Cancelar
                    </a>
                    
                    <button type="submit" 
                            id="delete-button"
                            disabled
                            class="inline-flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200">
                        <i class="fas fa-trash mr-2"></i>
                        Confirmar Exclus√£o
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Additional Information -->
    <div class="mt-8 bg-blue-50 rounded-xl border border-blue-200 p-6">
        <div class="flex items-start">
            <div class="flex-shrink-0">
                <i class="fas fa-info-circle text-blue-600 text-xl"></i>
            </div>
            <div class="ml-3">
                <h3 class="text-sm font-medium text-blue-900">
                    Informa√ß√µes Importantes
                </h3>
                <div class="mt-2 text-sm text-blue-800">
                    <ul class="list-disc list-inside space-y-1">
                        <li>A exclus√£o do evento √© permanente e n√£o pode ser desfeita</li>
                        <li>Todos os dados relacionados ao evento ser√£o removidos do sistema</li>
                        <li>Participantes que receberam notifica√ß√µes n√£o ser√£o informados automaticamente sobre a exclus√£o</li>
                        <li>Recomendamos exportar os dados importantes antes de proceder com a exclus√£o</li>
                        <li>Esta a√ß√£o ser√° registrada nos logs de auditoria do sistema</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmationInput = document.getElementById('confirmation');
    const deleteButton = document.getElementById('delete-button');
    const deleteForm = document.getElementById('delete-form');
    const eventName = '{{ event.name|escapejs }}';

    // Enable/disable delete button based on confirmation input
    confirmationInput.addEventListener('input', function() {
        if (this.value.trim() === eventName) {
            deleteButton.disabled = false;
            deleteButton.classList.remove('opacity-50', 'cursor-not-allowed');
        } else {
            deleteButton.disabled = true;
            deleteButton.classList.add('opacity-50', 'cursor-not-allowed');
        }
    });

    // Handle form submission
    deleteForm.addEventListener('submit', function(event) {
        // Double confirmation
        if (!confirm('Tem absoluta certeza de que deseja excluir este evento? Esta a√ß√£o n√£o pode ser desfeita.')) {
            event.preventDefault();
            return false;
        }

        // Disable button and show loading state
        deleteButton.disabled = true;
        deleteButton.innerHTML = `
            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Excluindo...
        `;

        // Let the form submit normally
        return true;
    });

    // Focus on confirmation input
    confirmationInput.focus();

    // Prevent accidental page navigation
    window.addEventListener('beforeunload', function(event) {
        if (confirmationInput.value.trim().length > 0) {
            event.preventDefault();
            event.returnValue = '';
        }
    });
});
</script>
{% endblock %}